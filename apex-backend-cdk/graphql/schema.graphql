
scalar AWSJSON
scalar AWSDateTime

type UserProfile {
  user_id: ID!          # Cognito sub
  email: AWSEmail!
  username: String!
  country: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

input UpsertUserProfileInput {
  username: String!
  country: String!
  email: AWSEmail!
}

type Race {
  PK: String!
  SK: String!
  entityType: String!
  race_id: String!
  race_name: String!
  season: String!
  qualy_date: String
  race_date: String
  category: String!
  circuit: String
  country: String
  status: String
  has_sprint: Boolean
  createdAt: String
  updatedAt: String
}

type Driver {
  PK: String!
  SK: String!
  entityType: String!
  driver_id: String!
  name: String!
  team: String
  number: Int
  imageUrl: String
  teamColor: String
  isActive: Boolean
  nationality: String
  birthDate: String
  season: String!
  category: String!
  createdAt: String
  updatedAt: String
}

type Result {
  PK: String!
  SK: String!
  entityType: String!
  race_id: String!
  results: String
  season: String!
  category: String!
  createdAt: String
  updatedAt: String
}

type RacesResponse {
  items: [Race!]!
  nextToken: String
}

type DriversResponse {
  items: [Driver!]!
  nextToken: String
}

type ResultsResponse {
  items: [Result!]!
  nextToken: String
}

type RacePrediction {
  series: String!
  season: String!
  raceId: String!
  userId: ID!
  prediction: String!  # JSON string stored as String (simpler)
  points: Int!          # starts at 0
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type RacePredictionConnection {
  items: [RacePrediction!]!
  nextToken: String
}

input UpsertPredictionInput {
  series: String!
  season: String!
  raceId: String!
  prediction: String!  # JSON string
}

type LeaderboardEntry {
  PK: String!
  SK: String!
  entityType: String!
  userId: ID!
  category: String!
  season: String!
  totalPoints: Int!
  username: String!
  numberOfRaces: Int!
  byUserPK: String!
  byUserSK: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type LeaderboardConnection {
  items: [LeaderboardEntry!]!
  nextToken: String
}

input UpsertLeaderboardEntryInput {
  category: String!
  season: String!
  totalPoints: Int!
  username: String!
  numberOfRaces: Int!
}

type Query {
  getMyProfile: UserProfile
  getRaces(category: String!, season: String!, limit: Int, nextToken: String): RacesResponse
  getDrivers(category: String!, season: String!, limit: Int, nextToken: String): DriversResponse
  getResults(category: String!, season: String!, limit: Int, nextToken: String): ResultsResponse
  # list all races/predictions of the logged-in user (via GSI)
  listMyRaces(series: String, season: String, limit: Int = 50, nextToken: String): RacePredictionConnection!
  # optional: fetch my prediction for a specific race
  getMyPrediction(series: String!, season: String!, raceId: String!): RacePrediction
  # Leaderboard queries
  getLeaderboard(category: String!, season: String!, limit: Int, nextToken: String): LeaderboardConnection!
  getMyLeaderboardEntry(category: String!, season: String!): LeaderboardEntry
}

type Mutation {
  upsertMyProfile(input: UpsertUserProfileInput!): UserProfile
  upsertPrediction(input: UpsertPredictionInput!): RacePrediction!
  upsertLeaderboardEntry(input: UpsertLeaderboardEntryInput!): LeaderboardEntry!
}
