
scalar AWSJSON
scalar AWSDateTime

type UserProfile {
  userId: ID!          # Cognito sub
  email: AWSEmail!
  username: String!
  country: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

input UpsertUserProfileInput {
  username: String!
  country: String!
  email: AWSEmail!
}

type Race {
  PK: String!
  SK: String!
  entityType: String!
  raceId: String!
  raceName: String!
  season: String!
  qualyDate: String
  raceDate: String
  category: String!
  circuit: String
  country: String
  status: String
  hasSprint: Boolean
  createdAt: String
  updatedAt: String
}

type Driver {
  PK: String!
  SK: String!
  entityType: String!
  driverId: String!
  name: String!
  team: String
  number: Int
  imageUrl: String
  teamColor: String
  isActive: Boolean
  nationality: String
  birthDate: String
  season: String!
  category: String!
  createdAt: String
  updatedAt: String
}

type Result {
  PK: String!
  SK: String!
  entityType: String!
  raceId: String!
  results: AWSJSON
  season: String!
  category: String!
  createdAt: String
  updatedAt: String
}

type RacesResponse {
  items: [Race!]!
  nextToken: String
}

type DriversResponse {
  items: [Driver!]!
  nextToken: String
}

type ResultsResponse {
  items: [Result!]!
  nextToken: String
}

type RacePrediction {
  category: String!
  season: String!
  raceId: String!
  userId: ID!
  prediction: AWSJSON!
  points: Int!          # starts at 0
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type RacePredictionConnection {
  items: [RacePrediction!]!
  nextToken: String
}

input UpsertPredictionInput {
  category: String!
  season: String!
  raceId: String!
  prediction: AWSJSON!
}

type LeaderboardEntry {
  PK: String!
  SK: String!
  entityType: String!
  userId: ID!
  category: String!
  season: String!
  totalPoints: Int!
  username: String!
  numberOfRaces: Int!
  nationality: String
  byUserPK: String!
  byUserSK: String!
  createdAt: String
  updatedAt: String
}

type LeaderboardConnection {
  items: [LeaderboardEntry!]!
  nextToken: String
}

input UpsertLeaderboardEntryInput {
  category: String!
  season: String!
  totalPoints: Int!
  username: String!
  numberOfRaces: Int!
  nationality: String
}

type League {
  PK: String!
  SK: String!
  entityType: String!
  leagueId: String!
  name: String!
  createdByUserId: ID!
  createdAt: String!
  byCode: String!
  description: String
}

type LeagueMember {
  PK: String!
  SK: String!
  entityType: String!
  leagueId: String!
  userId: ID!
  username: String
  role: String!
  leagueName: String
  code: String
  description: String
  createdAt: String
  updatedAt: String
}

type LeagueMemberConnection {
  items: [LeagueMember!]!
  nextToken: String
}

type LeagueLeaderboardEntry {
  PK: String!
  SK: String!
  entityType: String!
  leagueId: String!
  userId: ID!
  category: String!
  season: String!
  totalPoints: Int!
  username: String!
  numberOfRaces: Int!
  nationality: String
}

type LeagueLeaderboardConnection {
  items: [LeagueLeaderboardEntry!]!
  nextToken: String
}

input CreateLeagueInput {
  name: String!
  description: String
  category: String!
  season: String!
}

input CopyLeaderboardToLeagueInput {
  leagueId: String!
  category: String!
  season: String!
}

input CreateLeagueMemberInput {
  leagueId: String!
  leagueName: String!
  role: String
  code: String
}

input LeagueLeaderboardEntryInput {
  leagueId: String!
  userId: ID!
  username: String!
  totalPoints: Int!
  numberOfRaces: Int!
  nationality: String
  category: String!
  season: String!
}

input LeaguePredictionEntryInput {
  leagueId: String!
  userId: ID!
  category: String!
  season: String!
  raceId: String!
  prediction: AWSJSON!
  points: Int!
  pointsPadded: String
}

type Query {
  getMyProfile: UserProfile
  getRaces(category: String!, season: String!, limit: Int, nextToken: String): RacesResponse
  getDrivers(category: String!, season: String!, limit: Int, nextToken: String): DriversResponse
  getResults(category: String!, season: String!, limit: Int, nextToken: String): ResultsResponse
  # list all races/predictions of the logged-in user (via GSI)
  listMyRaces(category: String, season: String, limit: Int = 50, nextToken: String): RacePredictionConnection!
  # optional: fetch my prediction for a specific race
  getMyPrediction(category: String!, season: String!, raceId: String!): RacePrediction
  # fetch predictions for a given userId (via GSI)
  getPredictions(userId: ID!, category: String, season: String, limit: Int = 50, nextToken: String): RacePredictionConnection!
  # Leaderboard queries
  getLeaderboard(category: String!, season: String!, limit: Int, nextToken: String): LeaderboardConnection!
  getMyLeaderboardEntry(category: String!, season: String!): LeaderboardEntry
  # League queries
  getMyLeagues(limit: Int, nextToken: String): LeagueMemberConnection!
  getLeagueByCode(byCode: String!): League
  getLeagueMembers(leagueId: String!, limit: Int, nextToken: String): LeagueMemberConnection!
  getLeagueLeaderboard(leagueId: String!, category: String!, season: String!, limit: Int, nextToken: String): LeagueLeaderboardConnection!
  # Get league race leaderboard - all predictions for a specific race in a league (sorted by points)
  getLeagueRaceLeaderboard(leagueId: String!, category: String!, raceId: String!, limit: Int, nextToken: String): RacePredictionConnection!
  # Get all leaderboard entries for a specific user across all categories/seasons
  getLeaderboardsByUserId(userId: ID!, limit: Int, nextToken: String): LeaderboardConnection!
  # Get race leaderboard - all predictions for a specific race (sorted by points)
  getRaceLeaderboard(category: String!, raceId: String!, limit: Int, nextToken: String): RacePredictionConnection!
}

type Mutation {
  upsertMyProfile(input: UpsertUserProfileInput!): UserProfile
  initMyLeaderboards: Boolean!
  upsertPrediction(input: UpsertPredictionInput!): RacePrediction!
  upsertLeaderboardEntry(input: UpsertLeaderboardEntryInput!): LeaderboardEntry!
  createLeague(input: CreateLeagueInput!): League!
  createLeagueMember(input: CreateLeagueMemberInput!): LeagueMember!
  copyLeaderboardToLeague(input: CopyLeaderboardToLeagueInput!): Boolean!
  batchCreateLeagueLeaderboardEntries(entries: [LeagueLeaderboardEntryInput!]!): Boolean!
  batchCreateLeaguePredictionEntries(entries: [LeaguePredictionEntryInput!]!): Boolean!
}
